<!--
Author: W3layouts
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>

<head>
  <title>Translate Landing Page</title>
  <!-- for-mobile-apps -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <!-- //for-mobile-apps 
  <link href='//fonts.googleapis.com/css?family=Questrial' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,700italic,800,800italic'
    rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/j-forms.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
  <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />-->
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise"></script>
  <!-- Latest version of Box Content Preview for en-US locale -->
  <script src="https://cdn01.boxcdn.net/platform/preview/1.53.1/en-US/preview.js"></script>
  <link rel="stylesheet" href="https://cdn01.boxcdn.net/platform/preview/1.53.1/en-US/preview.css" />
  <!-- Load AWS JavaScript SDK -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.329.0.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  <script>
    var params = new URLSearchParams(window.location.search);

    //get auth code and //ID
    //Send request to lamdba? or to EC2
    $(document).ready(function () {
      var gaccessToken = "";
      var gfileId="";
      var grefreshToken="";

      var entries = params.entries();
      for (pair of entries) {
        $("#test").append(pair[0] + "=" + pair[1] + "<br/>");
      }

      var form = new FormData();
      form.append("grant_type", "authorization_code");
      form.append("code", params.get("MessageAttribute.3.Value.StringValue"));
      form.append("client_id", "18rcz7p3g6jzmu08v5ad1cq70pj928kw");
      form.append("client_secret", "uIQGd76hrSdrOiyz1vTsceHoPWvQdd9x");

      var settings = {
        "async": false,
        "crossDomain": true,
        "url": "https://api.box.com/oauth2/token",
        "method": "POST",
        "processData": false,
        "contentType": false,
        "mimeType": "multipart/form-data",
        "data": form
      }

      $.ajax(settings).done(function (response) {
        var obj = JSON.parse(response);

        $("#accessToken").val(obj.access_token);
        gaccessToken = obj.access_token;
        grefreshToken=obj.refresh_token;
        gfileId=params.get("MessageAttribute.1.Value.StringValue");
        $("#refreshToken").val(obj.refresh_token);
        $("#test").append(response + "<br/>");
        //alert($("#accessToken").val());
      });

      $("#authCode").val(params.get("authCode"));
      $("#fileId").val(params.get("fileId"));
      $("#accessToken").val(params.get("accessToken"));
      $("#refreshToken").val(params.get("refreshToken"));

      var preview = new Box.Preview();
      //alert("Preview:" + gaccessToken);
      $("#preview-container").show();

      preview.show(gfileId, gaccessToken, {
        container: '.preview-container',
        showDownload: false
      });


      params.get("MessageAttribute.1.Name");
      var transform = document.getElementById("transform");
      transform.addEventListener("submit", function (e) {
        e.preventDefault();

      });
      $("#foot").hide();


      $("#submitbutton").on('click', function (e) {
        //e.preventDefault();
        alert("Button Clicked");
        // Load the AWS SDK for Node.js
        var AWS = require('aws-sdk');
        // Set the region 
        AWS.config.update({
          region: 'us-east-1'
        });

        // Create an SQS service object
        var sqs = new AWS.SQS({
          apiVersion: '2012-11-05'
        });

        var params = {
          DelaySeconds: 10,
          MessageAttributes: {
            "accessToken": {
              DataType: "String",
              StringValue: gaccessToken
            },
            "refreshToken": {
              DataType: "String",
              StringValue: grefreshToken
            },
            "fileId": {
              DataType: "String",
              StringValue: gfileId
            }
          },
          MessageBody: gaccessToken,
          QueueUrl: "https://sqs.us-east-1.amazonaws.com/872043526251/box_sample_queue"
        };

        sqs.sendMessage(params, function (err, data) {
          if (err) {
            console.log("Error", err);
          } else {
            console.log("Success", data.MessageId);
          }
        });

      });

    });
  </script>

</head>

<body>
  <div class="content" id='main'>
    <h1>Slice the video - https://sqs.us-east-1.amazonaws.com/872043526251/box_sample_queue?Action=SendMessage&MessageAttribute.1.Value.DataType=String&MessageAttribute.1.Name=FileId&MessageAttribute.2.Value.DataType=String&MessageAttribute.2.Name=userName&MessageAttribute.3.Value.DataType=String&MessageAttribute.3.Name=authCode</h1>
    <div class="main">
      <div class="txt-center">
        <img class="logo" src="images/wezen.png" />
      </div>
      <form class="contact-forms" id="transform">

        <!-- first row of fields -->
        <div class="first-line">
          <div class="span6 main-row">
            <div class="input">Start Time:
              <input type="text" id="starttime" name="starttime" value="0:00">
            </div>
          </div>
          <div class="span6 main-row">
            <div class="input">Duration (Seconds):
              <input type="text" id="duration" name="duration" value="5">
            </div>
          </div>
          <div class="span6 main-row">
            <div class="input">Auth Code:
              <input type="text" id="authCode" name="authCode" value="">
            </div>
          </div>
          <div class="span6 main-row">
            <div class="input">FileId:
              <input type="text" id="fileId" name="fileId" value="">
            </div>
          </div>
          <div class="span6 main-row">
            <div class="input">Access Token:
              <input type="text" id="accessToken" name="accessToken" value="">
            </div>
          </div>
          <div class="span6 main-row">
            <div class="input">Refresh Token:
              <input type="text" id="refreshToken" name="refreshToken" value="">
            </div>
          </div>

        </div>
        <!-- end first row of fields -->

        <!-- second row of fields -->
        <!-- <div class="first-line">
  						<div class="span6 main-row">
  							<div class="input" id="detected">
  							</div>
  						</div>
              <div class="span6 main-row">
                <div class="input">Target language:
                  <select  id="lang" name="lang" placeholder="Target Language">

                    <option value='fr'>French</option>
                    <option value='en'>English</option>
                    <option value='sv'>Swedish</option>
                    <option value='da'>Danish</option>
                    <option value='es'>Spanish</option>
                    <option value='af'>Afrikaans</option>
                    <option value='el'>Greek</option>
                  </select>


                </div>

              </div>
            </div>
              <div class="first-line">
    						<div class="span6 main-row">
    							<div class="input" id="price">
    							</div>
    						</div>

              </div> -->
        <!-- end second row of fields -->

        <!-- start file upload field -->

        <!-- end files -->

        <!-- footer -->
        <div class="footer" id="foot">
          <button type="submit" class="primary-btn">Accept & Send</button>
        </div>

        <div id="submit">
          <button type="button" id="submitbutton" name="submitbutton">Transcode</button>
        </div>
        <div id="loader">
          <img src="images/ajax-loader-gif-1.gif" />
        </div>
        <!-- footer -->

      </form>
    </div>

    <div id="preview-container" class="preview-container" style="height:400px; width:100%;"></div>

    <p class="copy_rights" id='test'></p>
  </div>
</body>

</html>