<html>
<title>Events Viewer</title>
<head>
  <!-- jQuery -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


  <link href='//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
  <script src='//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.css"/>

  <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.18/datatables.min.js"></script>

<script>
   var stream_position = "0";//sessionStorage.getItem("streamPosition");

  $(document).ready(function() {
    $('ul.tabs li').click(function() {
      var tab_id = $(this).attr('data-tab');
      $('ul.tabs li').removeClass('current');
      $('.tab-content').removeClass('current');
      $(this).addClass('current');
      $("#" + tab_id).addClass('current');
    });
    var t = $('#contentlist').DataTable({
        "order": [[ 1, "desc" ]],
        "select": true,
        "dom": "Bfrtip",
        "pageLength": 25,
        "ajax":{
          "url": "https://api.box.com/2.0/events?limit=500&stream_position=" + stream_position,
          "type": "GET",
          "dataSrc": "entries",
          "headers": {"Authorization": "Bearer " + sessionStorage.getItem("accessToken")
          }
        },
        "columns": [
          {
            "data": "event_type"
          },
          {
            "data":null,
            render: function(data,type,row) {
              var date = new Date(Date.parse(row.created_at));
              return date.toLocaleString('en-GB', { timeZone: 'UTC' });

            }
          },
          {
            "data":null,
              render: function(data, type, row) {
                if(row.event_type && row.event_type.startsWith('ITEM')) {
                  return row.source.name;
                }
                else if(row.event_type.startsWith("COLLAB"){
                    return row.item.name;
                }
            }
          },
          {
            "data":null,
              render: function(data, type, row) {
              if(row.event_type.startsWith("COLLAB_")) {
                    return row.accesible_by.name + " as " + row.role + " on " + row.item.type + " " + row.item.name;
                }
            }
          },
          {
            "data":null,
              render: function(data, type, row) {
                return JSON.stringify(row.source);
            }
          }
        ]});

  });



</script>
<style>
th {font-family:Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;font-size:15px;}
td {font-family:Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;font-size:13px;}
ul.tabs{
			margin: 0px;
			padding: 0px;
			list-style: none;
		}
		ul.tabs li{
			background: none;
			color: #222;
			display: inline-block;
			padding: 10px 15px;
			cursor: pointer;
      font-family:Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;font-size:15px;
		}

		ul.tabs li.current{
			background: #ededed;
			color: #222;
      font-family:Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;font-size:15px;
		}
    .tab-content{
  			display: none;
  			background: #ededed;
  			padding: 15px;
  		}

  		.tab-content.current{
  			display: inherit;
  		}
      .tab-content{
  			display: none;
  			background: #ededed;
  			padding: 15px;
  		}

  		.tab-content.current{
  			display: inherit;
  		}
      .sameline {
        display: inline;
      }
</style>

</head>

<body>
  <div style="padding: 5 5 5 5px;bgcolor='#F4F6F9';border: 1px solid #cdd4de;">
    <ul class="tabs">
      <li class="tab-link current" data-tab="tab-100">My Events</li>
      <li class="tab-link" data-tab="tab-200">Malicious file events</li>
  </ul>
<div id="tab-100" class="tab-content current">
      <table id="contentlist" class="display" style="width:95%%">
        <thead>
            <th>Event</th>
            <th>Created</th>
            <th>Name</th>
            <th>Details</th>

            <th>Source</th>
          </thead>
          <tbody>
          </tbody>

    </table>
  </div>
  <div id="tab-200" class="tab-content">
    Malicious files
  </div>
</div>
  </body>
</html>
